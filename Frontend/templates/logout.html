{% extends "base.html" %}


{% block title %}
<script src="../static/js/validateForm.js"></script>
<title>Log out</title>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.querySelector('.logout-form');
        const errorBlock = document.querySelector('.error-block');

        form.addEventListener('submit', (event) => {
            event.preventDefault();

            let formData = new FormData(form);
            formData = Object.fromEntries(formData.entries());
            const csrfToken = getCSRFToken();

            fetch('/api/logout/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken,
                },
                body: JSON.stringify(formData),
            })
                .then(response => {
                    if (response.ok) {
                        return response.json().then(formData => {
                            console.log('Successfully logged out!', formData['msg']);
                            window.location.href = '/';
                        });
                    } else {
                        return response.json().then(errorData => {
                            const errorCount = Object.keys(errorData)[0].length;
                            const errorKey = Object.keys(errorData)[0];
                            const errorValue = errorData[errorKey][0];
                            toggleCssClasses(errorBlock, 'hidden', 'shown');
                            errorBlock.textContent = errorData['msg'];
                            console.error('Logout errors:', errorData);
                            throw new Error('Logout failed');
                        });
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });
    });
</script>
{% endblock title %}
{% block navopt %}
<a href="/register" class=" ml-3 " style="text-decoration-line: none;">
    <div class="text-dark">
        <p onmouseout="this.style.borderBottom='2px solid rgba(0, 0, 0, 0)';" onmouseover="this.style.borderBottom='solid 2px rgba(0, 103, 164, 1)';" style="font-size: x-large;">
            Register
        </p>
    </div>
</a>
{% endblock navopt%}

{% block content %}
<div id="CustomForm">
    <h1>Log out</h1>
    <h2>from {{ user.email }}</h2>
    <form method="post" class="logout-form">
        {% csrf_token %}
        
        <input type="submit" value="Log out">
    </form>
</div>
{% endblock content %}